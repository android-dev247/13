<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<title>å…¨èƒ½ä»£ç ç¼–è¾‘å™¨</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif}
html,body{height:100%;overflow:hidden;background:#111827;color:#f9fafb}
.container{display:flex;flex-direction:column;height:100%}
.toolbar{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;padding:10px;background:#1f2937;border-bottom:1px solid #374151}
button{padding:12px 8px;border:none;border-radius:8px;background:#4f46e5;color:white;font-weight:600;cursor:pointer}
button:active{background:#4338ca}
#code_area{flex:1;background:#1f2937;color:#f9fafb;border:none;outline:none;padding:12px;font-size:15px;line-height:1.6;resize:none;font-family:Consolas,Monaco,monospace}
#preview_area{width:100%;height:36vh;background:#ffffff;border:none;border-top:1px solid #374151}
#log_area{height:14vh;background:#111827;padding:10px;font-size:13px;line-height:1.4;overflow-y:auto;color:#e5e7eb;border-top:1px solid #374151}
.log_success{color:#10b981}
.log_error{color:#ef4444}
.log_info{color:#60a5fa}
</style>
</head>
<body>
<div class="container">
  <div class="toolbar">
    <button id="run_btn">â–¶ è¿è¡Œä»£ç </button>
    <button id="clear_btn">æ¸…ç©ºä»£ç </button>
    <button id="save_btn">ğŸ’¾ ä¿å­˜æ–‡ä»¶</button>
  </div>
  <textarea id="code_area" spellcheck="false"></textarea>
  <iframe id="preview_area"></iframe>
  <div id="log_area"></div>
</div>

<script>
const code = document.getElementById('code_area');
const preview = document.getElementById('preview_area');
const log = document.getElementById('log_area');
const runBtn = document.getElementById('run_btn');
const clearBtn = document.getElementById('clear_btn');
const saveBtn = document.getElementById('save_btn');

let currentObjectURL = null;

function showLog(text, type) {
  const line = document.createElement('div');
  line.className = 'log_' + type;
  line.textContent = text;
  log.appendChild(line);
  log.scrollTop = log.scrollHeight;
  if (log.children.length > 50) {
    log.removeChild(log.firstChild);
  }
}

function clearLog() {
  log.innerHTML = '';
}

function runCode() {
  clearLog();
  showLog('æ­£åœ¨è¿è¡Œä»£ç ...', 'info');
  try {
    if (!code.value.trim()) {
      throw new Error('ä»£ç å†…å®¹ä¸èƒ½ä¸ºç©º');
    }
    if (currentObjectURL) {
      URL.revokeObjectURL(currentObjectURL);
      currentObjectURL = null;
    }
    const blob = new Blob([code.value], { type: 'text/html' });
    currentObjectURL = URL.createObjectURL(blob);
    preview.src = currentObjectURL;
    showLog('âœ… ä»£ç è¿è¡ŒæˆåŠŸ', 'success');
  } catch (err) {
    showLog('âŒ é”™è¯¯ï¼š' + err.message, 'error');
  }
}

function clearCode() {
  if (code.value.trim() === '') {
    showLog('â„¹ï¸ ä»£ç å·²ç»æ˜¯ç©ºçš„', 'info');
    return;
  }
  code.value = '';
  clearLog();
  preview.src = 'about:blank';
  showLog('âœ… å·²æ¸…ç©ºæ‰€æœ‰ä»£ç ', 'success');
}

function saveFile() {
  try {
    const content = code.value.trim();
    if (!content) {
      showLog('âŒ æ— æ³•ä¿å­˜ï¼šä»£ç ä¸ºç©º', 'error');
      return;
    }
    const blob = new Blob([content], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.download = 'æˆ‘çš„ç½‘é¡µ.html';
    a.href = url;
    a.click();
    setTimeout(() => {
      URL.revokeObjectURL(url);
    }, 1000);
    showLog('âœ… æ–‡ä»¶å·²ä¿å­˜ï¼šæˆ‘çš„ç½‘é¡µ.html', 'success');
    showLog('ğŸ’» Windowsï¼šä¿å­˜åˆ°æ¡Œé¢/ä¸‹è½½', 'info');
    showLog('ğŸ“± æ‰‹æœºï¼šä¿å­˜åˆ°å†…éƒ¨å­˜å‚¨/ä¸‹è½½', 'info');
  } catch (e) {
    showLog('âŒ ä¿å­˜å¤±è´¥ï¼š' + e.message, 'error');
  }
}

runBtn.addEventListener('click', runCode);
clearBtn.addEventListener('click', clearCode);
saveBtn.addEventListener('click', saveFile);

code.value = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘çš„ç½‘é¡µ</title>
<style>
body{
  background: #f0f9ff;
  font-family: Arial;
  text-align: center;
  padding: 30px;
}
h1{
  color: #4f46e5;
}
</style>
</head>
<body>
<h1>æ¬¢è¿ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨</h1>
<p>ç‚¹å‡»ã€è¿è¡Œã€‘æŸ¥çœ‹æ•ˆæœ</p>
<p>ä¿®æ”¹è¿™é‡Œçš„ä»£ç ï¼Œç„¶åè¿è¡Œ</p>
</body>
</html>`;

showLog('âœ… ç¼–è¾‘å™¨åŠ è½½å®Œæˆ', 'success');
showLog('â„¹ï¸ ç‚¹å‡»ã€è¿è¡Œã€‘æ‰§è¡Œä»£ç ', 'info');
showLog('â„¹ï¸ ç‚¹å‡»ã€ä¿å­˜ã€‘å¯¼å‡ºHTMLåˆ°æœ¬åœ°', 'info');
</script>
</body>
</html>
